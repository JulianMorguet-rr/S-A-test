--- 
import { fade  } from 'astro:transitions';
import { urlFor } from '../lib/sanityApi.js';

import { PageContent } from '../types/PageContent';
interface PostContent {
    mainImage: string;
    mainImageAltText: string;
    title: string;
    slug: string;
}
import { Image } from 'astro:assets';

// Destrukturieren Sie Astro.props in eine andere Variable
const { pageContent, postContent } = Astro.props as { pageContent: PageContent, postContent: PostContent };

const useBackgroundAnimation = (type) => {
    if (type === 'post') {
        if (postContent?.mainImage) {
            return false;
        } else {
            return true;
        }
    } else {
        if (pageContent?.heroBackgroundVideo || pageContent?.heroImage) {
            return false;
        } else {
            return true;
        }
    }
}

---

<div class="hero" style={`aspect-ratio: 1920 / 640;`} >

    <!-- <p>
        {JSON.stringify(pageContent)}
    </p> -->

    { pageContent &&

        <>

        { pageContent?.heroBackgroundVideo ? ( 
                <div class="inline-video">
                    <video autoplay loop muted playsinline class="hero-background-video" aria-label={pageContent.heroImageAlt || 'Stimmungs Assets'} >
                        <source src={`https://geschmaecker-sind-verschieden.com/video-api/${pageContent.heroBackgroundVideo.webmPath}`} type="video/webm">
                        <source src={`https://geschmaecker-sind-verschieden.com/video-api/${pageContent.heroBackgroundVideo.mp4Path}`} type="video/mp4">
                        <p>
                            Ihr Browser unterstützt kein HTML video. Hier ist ein 
                            <a href={`https://geschmaecker-sind-verschieden.com/video-api/${pageContent.heroBackgroundVideo.mp4Path}`}>Link zu dem Video</a>.
                        </p>
                    </video> 
                </div>
            ) : 
            pageContent?.heroImage ? (
                <Image 
                    width="1920"
                    height="640"
                    src={urlFor(pageContent.heroImage).width(1920).height(640).format('webp').url()} 
                    alt={pageContent.heroImageAlt || "Hero Image"}
                />
                <!-- 
                    transition:name={`hero-image-${pageContent.slug}`}
                    transition:animate="initial"
                -->
            ) : (
                <div class="animated-bg-gradient">
                </div>
            )
        }

        { pageContent?.heading &&
            <div class="headline-wrapper mb-4">
                <h1 class={`${useBackgroundAnimation('page') ? 'background-animation' : null} clip-text text-4xl font-bold text-gray-900 dark:text-white`}>
                    <span>{pageContent.heading}</span>
                </h1>
            </div>
        }

        <!--
        {
            pageContent?.heroBackgroundVideo && ( 
                <div>
                    <video autoplay loop muted playsinline class="hero-background-video">
                        <source src={`https://geschmaecker-sind-verschieden.com/video-api/${pageContent.heroBackgroundVideo.webmPath}`} type="video/webm">
                        <source src={`https://geschmaecker-sind-verschieden.com/video-api/${pageContent.heroBackgroundVideo.mp4Path}`} type="video/mp4">
                    </video> 
                </div>
            )
        }
        -->

        </>

    }



    {   
        postContent &&

            <>

            {
                postContent.mainImage ? (
                    <Image 
                        width="1920"
                        height="640"
                        src={urlFor(postContent.mainImage).width(1920).height(640).format('webp').url()} 
                        alt={postContent.mainImageAltText || "Hero Image"}
                        transition:name={`post-image-${postContent.slug}`}
                        transition:animate='initial'
                    />
                ) : (
                <div class="animated-bg-gradient"></div>
                )

            }

            

            { 
                postContent?.title &&
                    <div class="headline-wrapper mb-4">
                        <h1 class={`${useBackgroundAnimation('post') ? 'background-animation' : null} clip-text text-4xl font-bold text-gray-900 dark:text-white`}>
                            <span>{postContent.title}</span>
                        </h1>
                    </div>
            }

            </>

    }

    
</div> 
<div class="spacing"></div>


<style lang="scss">

    $basedelay: 0.2s;
    $base-duration: 1s;

    .hero {
        display: flex;
        justify-content: center;
        align-items: flex-end;
        min-height: 440px;

        

        .headline-wrapper {
            z-index: 9;
            position: absolute;
            padding: 4rem 2rem;

            // transform: translate(-6vw, 0rem);

            clip-path: polygon(0 0, 0 0, 0 100%, 0 100%);

            animation: maskFadeInFromLeft 1s $basedelay forwards; /* Animation anwenden und bei 100% anhalten */
            animation-fill-mode: forwards; /* Zustand bei 100% beibehalten */
            

            h1 {
                margin: auto;
                width: 100%;
                text-align: center;
                font-size: 4rem;
                font-weight: 800;

                // clip-path: polygon(0 0, 0 0, 0 100%, 0 100%);
                // margin-top: 30vh;
                // color: #fb923c;
                // text-shadow: 0 0 24px rgba(255,255,255,1);

                // font-family: Arvo,Arial,Sans-Serif;
                // background: linear-gradient(to right, rgb(251, 146, 60) 50%, transparent 50%); /* Anfangszustand: Harte Kante in der Mitte */
                background: rgb(251, 146, 60);

                background-size: 200% 100%; /* Größe des Verlaufs verdoppeln */
                background-position: 100% 0; /* Ausgangsposition ganz rechts */
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;

                margin: 0;
                line-height: 6rem;
                // animation: maskSlideHeading 1s 0.4s forwards; /* Animation anwenden und bei 100% anhalten */
                // animation-fill-mode: forwards; /* Zustand bei 100% beibehalten */

                &.background-animation {
                    // Testing Animation 
                    background: linear-gradient(45deg,#f77f7f,#eadb3a);
                    background-size: 200% 200%;

                    -webkit-background-clip: text;
                    -webkit-text-fill-color: transparent;

                    -webkit-animation: hero 10s infinite;
                    -moz-animation: hero 10s infinite;
                    -o-animation: hero 10s infinite;
                    animation: hero 10s infinite;
                }

                &:before {
                    content: '';
                    width: 100%;
                    height: 6rem;
                    background: linear-gradient(to right, #fff 50%, transparent 50%);
                    background-size: 200% 100%; /* Größe des Verlaufs verdoppeln */
                    background-position: 100% 0; /* Ausgangsposition ganz rechts */
                    position: absolute;
                    z-index: -1;
                    margin-left: -2rem;
                    animation: maskSlideBackground 1s $basedelay forwards; /* Animation anwenden und bei 100% anhalten */
                    animation-fill-mode: forwards; /* Zustand bei 100% beibehalten */
                }
            }
        }

        .inline-video {
            z-index: 6;
        }

        img {
            top: 0;
            left: 0;
            object-fit: cover;
            contain: paint;
            display: block;
            width: 100%;
            height: auto;
        }

        .animated-bg-gradient {
            background: linear-gradient(45deg,#f77f7f,#eadb3a);
            background-size: 200% 200%;
            -webkit-animation: hero 10s infinite;
            -moz-animation: hero 10s infinite;
            -o-animation: hero 10s infinite;
            animation: hero 10s infinite;
            box-shadow: 0 0 7px 0 rgba(0,0,0,.2);

            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;

            &:before {
                content: "";
                position: absolute;
                background-image: radial-gradient(circle at center center, #f89f9f 0%, rgb(255 152 0 / 0%) 66%);
                mix-blend-mode: hard-light;
                mix-blend-mode: multiply;
                opacity: 0;
                width: 50vw;
                height: 50vw;
                top: -25vw;
                left: -25vw;
                animation: heroBefore 10s infinite;
            }

            &:after {
                content: "";
                position: absolute;
                background-image: radial-gradient(circle at center center,#feae79 0%,rgba(255,152,0,0) 70%);
                mix-blend-mode: hard-light;
                mix-blend-mode: multiply;
                opacity: 0;
                width: 50vw;
                height: 50vw;
                bottom: -25vw;
                right: -25vw;

                animation: heroAfter 10s infinite;
            }
        }

    }


    // Create the Base Hero animation
    @keyframes hero {
        0%, 100% {
            background-position: 0 70%;
        }
        50% {
            background-position: 100% 31%;
        }
    }

    @keyframes heroBefore {
        0%, 100% {
            top: -20vw;
            left: -10vw;
            opacity: 0;
        }
        50% {
            top: 10vw;
            left: 10vw;
            opacity: 1;
        }
    }
    
    
    @keyframes heroAfter {
        0%, 100% {
            bottom: -20vw;
            right: -10vw;
            opacity: 0;
        }
        50% {
            bottom: 10vw;
            right: 10vw;
            opacity: 1;
        }
    }



    /* h1 Animation */ 

    @keyframes fadeUpIn {
            0% {
                transform: translate(0vw, 0rem);
            }
            100% {
                transform: translate(0, 0rem);
            }
        }

        @keyframes maskFadeInFromLeft {
            0% {
                clip-path: polygon(0 0, 0 0, 0 100%, 0 100%);
            }
            100% {
                clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);
            }
        }

    @keyframes maskSlideHeading {
        0% {
            background: linear-gradient(to right, rgb(251, 146, 60) 50%, transparent 50%); /* Anfangszustand: Harte Kante in der Mitte */
            background-size: 200% 100%; /* Größe des Verlaufs verdoppeln */
            background-position: 100% 0; /* Ausgangsposition ganz rechts */
            
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        100% {
            background: linear-gradient(to right, rgb(251, 146, 60) 50%, transparent 50%); /* Endzustand: Harte Kante in der Mitte bleibt erhalten */
            background-size: 200% 100%; /* Größe des Verlaufs bleibt gleich */
            background-position: 0% 0; /* Endposition ganz links */

            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;

            // clip-path: polygon(0 0, 100% 0, 100% 100%, 0 100%);
        }
    }


    /* Keyframe-Animation für :before erstellen */
    @keyframes maskSlideBackground {
        0% {
            background: linear-gradient(to right, #fff 50%, transparent 50%); /* Anfangszustand: Harte Kante in der Mitte */
            background-size: 200% 100%; /* Größe des Verlaufs verdoppeln */
            background-position: 100% 0; /* Ausgangsposition ganz rechts */
        }
        100% {
            background: linear-gradient(to right, #fff 50%, transparent 50%); /* Endzustand: Harte Kante in der Mitte bleibt erhalten */
            background-size: 200% 100%; /* Größe des Verlaufs bleibt gleich */
            background-position: 0% 0; /* Endposition ganz links */
        }
    }
    
</style>